"use strict";var DocumentViewer=function(a){var _ref=a?a:{},_ref$flatData=_ref.flatData,b=_ref$flatData===void 0?[]:_ref$flatData,_ref$actions=_ref.actions,c=_ref$actions===void 0?{}:_ref$actions,_ref$subMenu=_ref.subMenu,d=_ref$subMenu===void 0?{}:_ref$subMenu,_ref$sortable=_ref.sortable,_ref$selectable=_ref.selectable,_ref$alert=_ref.alert,h=_ref$alert===void 0?window.alert:_ref$alert,_ref$confirm=_ref.confirm,j=_ref$confirm===void 0?window.confirm:_ref$confirm,_ref$prompt=_ref.prompt,k=_ref$prompt===void 0?window.prompt:_ref$prompt,l=this,m=void 0,n=function(){var s=function(t,u){var v=[];for(var w in t)if(t[w].parentId==u){if(t[w].category){var x=s(t,t[w].id);t[w].children=x}v.push(t[w])}return v};return{toNestedTree:function toNestedTree(t){return s(t)},removeKey:function removeKey(t,u){return t.map(function(v){return delete v[u],v})},getItemIndex:function getItemIndex(t,u){for(var v=0;v<t.length;v++)if(t[v].id===u)return v;return-1},getItemById:function getItemById(t,u){return t.filter(function(v){return v.id==u})[0]},position:function position(t,u,v){return v+1==u?t:t.splice(v+1,0,t.splice(u,1)[0])}}}(),o=function(){var s=function(x,y){var z="";for(var A in x)if(x[A].filter(y)){var B="<a href='#' class='action-"+A+"'>"+x[A].icon+" "+A+"</a>";z+=B}return z},t=function(x){var y="\n\t\t\t\t<li class=\"product-wrapper\">\n\t\t\t\t\t<div id=\"leaf-"+x.id+"\" class=\"product-head\">\n\t\t\t\t\t\t<div class=\"checkbox\"><input type=\"checkbox\" name=\"product\" value=\"node-"+x.id+"\" /></div>\n\t\t\t\t\t\t<div class=\"title\">\n\t                    \t"+x.data.title+"\n\t                    </div>\n\t\t\t\t\t</div>\n\t\t\t\t</li>\n\t\t\t",z=s(c,y),A=s(d,y),B=$(y).find(".product-head"),C="";return z&&(C+="<div class=\"actions\">"+z+"</div>"),A&&(C+="<div class=\"contextmenu\"><span class=\"contexthead\">"+x.data.title+"</span>"+A+"</div>"),$(C).appendTo(B).parent().parent()[0].outerHTML},u=function(x){x&&0!==x.length||console.log("Category is empty");var y=[];return x&&(y=x.map(function(z){if(!z.category)return t(z);var A=u(z.children),B="\n\t\t\t\t\t\t<li class=\"category-wrapper\">\n\t\t\t\t\t\t\t<div class=\"accordian-link category-head\" id=\"node-"+z.id+"\">\n\t\t\t\t\t\t\t\t<div class=\"checkbox\"><input type=\"checkbox\" name=\"category\" value=\"node-"+z.id+"\" /></div>\n\t\t\t\t\t\t\t\t<div class=\"title\">\n\t\t\t\t\t\t\t\t\t"+z.data.title+"\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"accordian-content category-content\">\n\t\t\t\t\t\t\t\t"+(A||"")+"\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t",C=s(c,B),D=s(d,B),E=$(B).children(".category-head"),F="";return C&&(F+="<div class=\"actions "+z.id+"\">"+C+"</div>"),D&&(F+="<div class=\"contextmenu\"><span class=\"contexthead\">"+z.data.title+"</span>"+D+"</div>"),$(F).appendTo(E).parent().parent()[0].outerHTML})),"\n\t\t\t\t<ul class=\"accordian-container\">\n\t\t\t\t\t"+y.join("")+"\n\t\t\t\t</ul>\n\t\t\t"},v=function(x,y){var z=x[y].actions;z.before()&&z.after()},w=function(){$(".title, .actions, .contextmenu",$(".category-wrapper")).on("click",function(x){x.preventDefault(),x.stopPropagation()}),$(".category-head").on("click",function(x){x.target.classList.contains("category-head")&&$(this).toggleClass("active")}),$(document).on("contextmenu click",function(){$(".contextmenu").removeClass("active")}),$(".category-head, .product-head").on("contextmenu",function(x){return x.preventDefault(),x.stopPropagation(),$(".contextmenu").removeClass("active"),setTimeout(function(){$(".contextmenu",$(this)).toggleClass("active").css("left",x.screenX-50).css("top",x.screenY-110)}.bind(this),0),!1}),$(".category-head .actions a, .product-head .actions a").on("click",function(){var x=this.className.split("-")[1];v(c,x)}),$(".category-head .contextmenu a, .product-head .contextmenu a").on("click",function(){var x=this.className.split("-")[1];v(d,x)})};return{init:function init(){$(l).find(".document-viewer-body").html(u(m)),w(),n.removeKey(b,"children")}}}(),p=function(){var s=function(){$(l).find(".accordian-container .checkbox input").prop("checked",!1),$(l).find(".accordian-container").toggleClass("selectable")},t=function(w,x){$("#"+w).closest(".category-wrapper").find(".checkbox input").prop("checked",x)},u=function(){$("#action-selectable").on("click",function(w){$("#action-sortable")[0].innerText="Make Sortable",$(l).find(".accordian-container").removeClass("sortable"),w.target.innerText=$(l).find(".accordian-container").hasClass("selectable")?"Make Selectable":"Back to Unselectable",s()}),$(".category-head .checkbox input").on("change",function(w){console.log("e.target"),"category"===w.target.name&&t(w.target.value,w.target.checked),w.target.checked||$(this).parents(".category-wrapper").children(".category-head").find(".checkbox input").prop("checked",!1)})},v=function(){$(l).find(".document-viewer-head").append("<button id=\"action-selectable\" class=\"action\">Make Selectable</button>"),u()};return{init:function init(){v()}}}(),q=function(){var s=null,t=function(){$(".category-wrapper, .product-wrapper").prepend("<div class=\"drag-handle\" draggable=\"true\">&#x2630;</div>").append("<li class=\"drop-area\"></li>"),$("#dragging-item").length||$("body").append("<div id=\"dragging-item\"></div>"),$(l).find(".document-viewer-head").append("\n                <button id=\"action-sortable\" class=\"action\">Make Sortable</button>\n                <button id=\"action-save\" class=\"action\">Save Order</button>\n                "),x()},u=function(){$(l).find(".accordian-container").toggleClass("sortable")},v=function(y,z){var A=n.getItemById(b,y);A.parentId=z,-1===z&&delete A.parentId},w=function(y,z){n.position(b,n.getItemIndex(b,y),n.getItemIndex(b,z))},x=function(){$(".drag-handle").on("dragstart",function(y){$(this).parent().hasClass("category-wrapper")?(s=!1,y.originalEvent.dataTransfer.setData("text",$(this).siblings(".category-head").attr("id")),$(".product-wrapper > .drop-area").addClass("no-drop-zone")):(s=!0,y.originalEvent.dataTransfer.setData("text",$(this).siblings(".product-head").attr("id")),$(".category-wrapper > .drop-area").addClass("no-drop-zone")),$("#dragging-item").addClass("active").html($(".title",$(this).siblings(".category-head, .product-head")).text()),$(this).parent().addClass("dragging"),$(".category-head, .drop-area",$(this).parent()).addClass("no-drop-zone")}).on("drag",function(y){$("#dragging-item").css("left",y.screenX).css("top",y.screenY-80)}).on("dragend",function(y){y.preventDefault(),$("#dragging-item").removeClass("active").html(""),s=null,$(this).parent().removeClass("dragging"),$(".no-drop-zone").removeClass("no-drop-zone")}),$(".category-head, .drop-area").on("dragenter",function(){var z=$(this).data("ctr")?parseInt($(this).data("ctr")):0;$(this).data("ctr",++z),$(this).addClass("drag-enter")}).on("dragleave",function(){var z=parseInt($(this).data("ctr"));$(this).data("ctr",--z),0===z&&$(this).removeClass("drag-enter")}).on("dragover",function(y){y.preventDefault()}),$(".category-head").on("drop",function(y){if(y.preventDefault(),y.stopPropagation(),$(".drag-enter").data("ctr",0).removeClass("drag-enter"),0<$(this).siblings(".category-content").children()[0].children.length){var z=$(this).siblings(".category-content").children()[0].children[0];if(s&&z.classList.contains("category-wrapper")||!s&&!z.classList.contains("category-wrapper"))return s?h("Can only drop product into empty categories or inside categories having products"):h("Can only drop category into empty categories or inside categories having categories"),!1}if($(this).hasClass("no-drop-zone"))return!1;var A=y.originalEvent.dataTransfer.getData("text"),B=parseInt(A.split("-")[1]),C=parseInt($(this).attr("id").split("-")[1]);v(B,C),$(this).siblings(".category-content").children(0).append($("#"+A).parent()[0])}),$(".drop-area").on("drop",function(y){if(y.preventDefault(),y.stopPropagation(),$(".drag-enter").data("ctr",0).removeClass("drag-enter"),s&&$(this).parent().hasClass("category-wrapper")||!s&&!$(this).parent().hasClass("category-wrapper")||$(this).hasClass("no-drop-zone"))return!1;var z=y.originalEvent.dataTransfer.getData("text"),A=parseInt(z.split("-")[1]),B=-1,C=-1;B=s?parseInt($(this).siblings(".product-head").attr("id").split("-")[1]):parseInt($(this).siblings(".category-head").attr("id").split("-")[1]),0<$(this).closest(".category-content").length&&(C=parseInt($(this).closest(".category-content").siblings(".category-head").attr("id").split("-")[1])),w(A,B),v(A,C),$("#"+z).parent().insertAfter($(this).parent())}),$("#action-sortable").on("click",function(y){$("#action-selectable")[0].innerText="Make Selectable",$(l).find(".accordian-container").removeClass("selectable"),y.target.innerText=$(l).find(".accordian-container").hasClass("sortable")?"Make Sortable":"Back to Unsortable",u()}),$("#action-save").on("click",function(y){console.log("This is the final state after all the drag-drop and _repositioning"),console.log(b),console.log(JSON.stringify(b)),y.target.innerText="Saving...",setTimeout(function(){y.target.innerText="Save Order"},1e3)})};return{init:function init(){t()}}}(),r=function(){$(l).append("\n            <div class='document-viewer-head'>\n            </div>\n            <div class='document-viewer-body'>\n            </div>\n            <div class='document-viewer-footer'>\n            </div>\n        "),m=n.toNestedTree(b),o.init(),_ref$sortable!==void 0&&_ref$sortable&&q.init(),_ref$selectable!==void 0&&_ref$selectable&&p.init()}()};$.fn.extend({documentViewer:DocumentViewer});
